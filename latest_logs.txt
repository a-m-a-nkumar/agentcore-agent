1764847057046 - WARNING:  Invalid HTTP request received.
1764847057335 - {"timestamp": "2025-12-04T11:17:37.331Z", "level": "ERROR", "message": "Invocation failed (0.283s)", "logger": "bedrock_agentcore.app", "requestId": "4ec132a7-168d-4d81-8d35-3f79c5b43563", "sessionId": "d2233c63-3365-419e-ad1a-71990dd28947", "errorType": "AccessDeniedException", "errorMessage": "An error occurred (AccessDeniedException) when calling the ConverseStream operation: Model access is denied due to IAM user or service role is not authorized to perform the required AWS Marketplace actions (aws-marketplace:ViewSubscriptions, aws-marketplace:Subscribe) to enable access to this model. Refer to the Amazon Bedrock documentation for further details. Your AWS Marketplace subscription for this model cannot be completed at this time. If you recently fixed this issue, try again after 10 minutes.", "stackTrace": ["Traceback (most recent call last):\n", "  File \"/usr/local/lib/python3.13/site-packages/bedrock_agentcore/runtime/app.py\", line 381, in _handle_invocation\n    result = await self._invoke_handler(handler, request_context, takes_context, payload)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/usr/local/lib/python3.13/site-packages/bedrock_agentcore/runtime/app.py\", line 475, in _invoke_handler\n    return await loop.run_in_executor(None, ctx.run, handler, *args)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/usr/local/lib/python3.13/concurrent/futures/thread.py\", line 59, in run\n    result = self.fn(*self.args, **self.kwargs)\n", "  File \"/usr/local/lib/python3.13/site-packages/opentelemetry/instrumentation/threading/__init__.py\", line 171, in wrapped_func\n    return original_func(*func_args, **func_kwargs)\n", "  File \"/app/my_agent.py\", line 11, in invoke\n    result = agent(user_message)\n", "  File \"/usr/local/lib/python3.13/site-packages/strands/agent/agent.py\", line 349, in __call__\n    return run_async(\n        lambda: self.invoke_async(\n            prompt, invocation_state=invocation_state, structured_output_model=structured_output_model, **kwargs\n        )\n    )\n", "  File \"/usr/local/lib/python3.13/site-packages/strands/_async.py\", line 33, in run_async\n    return future.result()\n           ~~~~~~~~~~~~~^^\n", "  File \"/usr/local/lib/python3.13/concurrent/futures/_base.py\", line 456, in result\n    return self.__get_result()\n           ~~~~~~~~~~~~~~~~~^^\n", "  File \"/usr/local/lib/python3.13/concurrent/futures/_base.py\", line 401, in __get_result\n    raise self._exception\n", "  File \"/usr/local/lib/python3.13/concurrent/futures/thread.py\", line 59, in run\n    result = self.fn(*self.args, **self.kwargs)\n", "  File \"/usr/local/lib/python3.13/site-packages/opentelemetry/instrumentation/threading/__init__.py\", line 171, in wrapped_func\n    return original_func(*func_args, **func_kwargs)\n", "  File \"/usr/local/lib/python3.13/site-packages/strands/_async.py\", line 28, in execute\n    return asyncio.run(execute_async())\n           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^\n", "  File \"/usr/local/lib/python3.13/asyncio/runners.py\", line 195, in run\n    return runner.run(main)\n           ~~~~~~~~~~^^^^^^\n", "  File \"/usr/local/lib/python3.13/asyncio/runners.py\", line 118, in run\n    return self._loop.run_until_complete(task)\n           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^\n", "  File \"/usr/local/lib/python3.13/asyncio/base_events.py\", line 725, in run_until_complete\n    return future.result()\n           ~~~~~~~~~~~~~^^\n", "  File \"/usr/local/lib/python3.13/site-packages/strands/_async.py\", line 25, in execute_async\n    return await async_func()\n           ^^^^^^^^^^^^^^^^^^\n", "  File \"/usr/local/lib/python3.13/site-packages/strands/agent/agent.py\", line 392, in invoke_async\n    async for event in events:\n        _ = event\n", "  File \"/usr/local/lib/python3.13/site-packages/strands/agent/agent.py\", line 588, in stream_async\n    async for event in events:\n    ...<5 lines>...\n            yield as_dict\n", "  File \"/usr/local/lib/python3.13/site-packages/strands/agent/agent.py\", line 636, in _run_loop\n    async for event in events:\n    ...<13 lines>...\n        yield event\n", "  File \"/usr/local/lib/python3.13/site-packages/strands/agent/agent.py\", line 684, in _execute_event_loop_cycle\n    async for event in events:\n        yield event\n", "  File \"/usr/local/lib/python3.13/site-packages/strands/event_loop/event_loop.py\", line 155, in event_loop_cycle\n    async for model_event in model_events:\n        if not isinstance(model_event, ModelStopReason):\n            yield model_event\n", "  File \"/usr/local/lib/python3.13/site-packages/strands/event_loop/event_loop.py\", line 400, in _handle_model_execution\n    raise e\n", "  File \"/usr/local/lib/python3.13/site-packages/strands/event_loop/event_loop.py\", line 341, in _handle_model_execution\n    async for event in stream_messages(\n    ...<7 lines>...\n        yield event\n", "  File \"/usr/local/lib/python3.13/site-packages/strands/event_loop/streaming.py\", line 457, in stream_messages\n    async for event in process_stream(chunks, start_time):\n        yield event\n", "  File \"/usr/local/lib/python3.13/site-packages/strands/event_loop/streaming.py\", line 391, in process_stream\n    async for chunk in chunks:\n    ...<22 lines>...\n            handle_redact_content(chunk[\"redactContent\"], state)\n", "  File \"/usr/local/lib/python3.13/site-packages/strands/models/bedrock.py\", line 647, in stream\n    await task\n", "  File \"/usr/local/lib/python3.13/asyncio/threads.py\", line 25, in to_thread\n    return await loop.run_in_executor(None, func_call)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/usr/local/lib/python3.13/concurrent/futures/thread.py\", line 59, in run\n    result = self.fn(*self.args, **self.kwargs)\n", "  File \"/usr/local/lib/python3.13/site-packages/opentelemetry/instrumentation/threading/__init__.py\", line 171, in wrapped_func\n    return original_func(*func_args, **func_kwargs)\n", "  File \"/usr/local/lib/python3.13/site-packages/strands/models/bedrock.py\", line 768, in _stream\n    raise e\n", "  File \"/usr/local/lib/python3.13/site-packages/strands/models/bedrock.py\", line 683, in _stream\n    response = self.client.converse_stream(**request)\n", "  File \"/usr/local/lib/python3.13/site-packages/botocore/client.py\", line 602, in _api_call\n    return self._make_api_call(operation_name, kwargs)\n           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/usr/local/lib/python3.13/site-packages/amazon/opentelemetry/distro/patches/_botocore_patches.py\", line 510, in patched_api_call\n    result = original_func(*args, **kwargs)\n", "  File \"/usr/local/lib/python3.13/site-packages/botocore/context.py\", line 123, in wrapper\n    return func(*args, **kwargs)\n", "  File \"/usr/local/lib/python3.13/site-packages/botocore/client.py\", line 1078, in _make_api_call\n    raise error_class(parsed_response, operation_name)\n", "botocore.errorfactory.AccessDeniedException: An error occurred (AccessDeniedException) when calling the ConverseStream operation: Model access is denied due to IAM user or service role is not authorized to perform the required AWS Marketplace actions (aws-marketplace:ViewSubscriptions, aws-marketplace:Subscribe) to enable access to this model. Refer to the Amazon Bedrock documentation for further details. Your AWS Marketplace subscription for this model cannot be completed at this time. If you recently fixed this issue, try again after 10 minutes.\n", "└ Bedrock region: us-east-1\n", "└ Model id: us.anthropic.claude-sonnet-4-20250514-v1:0\n"], "location": "/usr/local/lib/python3.13/site-packages/bedrock_agentcore/runtime/app.py:_handle_invocation:402"}
